<div
  class="flex flex-col gap-2 px-6 py-3 rounded-xl border-l-4 shadow-sm"
  [ngClass]="cardClasses"
>
  <div class="flex justify-between items-start">
    <div>
      <h2 class="font-semibold">{{ assignment.title }}</h2>
      <p class="text-xs text-gray-500">{{ assignment.courseName }}</p>
      <p class="text-xs">Due: {{ assignment.dueDate | date: "shortDate" }}</p>
    </div>

    <div class="flex gap-2 items-center">
      <!-- Submit / Submitted Button -->
      <button
        *ngIf="assignment.effectiveStatus === 'active' || isSubmitted"
        [disabled]="isSubmitted || isDueDatePassed"
        (click)="openModal()"
        [ngClass]="{
          'bg-purple-200 text-purple-950': isActive,
          'bg-blue-200 cursor-not-allowed text-blue-950': isSubmitted,
          'bg-red-100 text-red-700 cursor-not-allowed': isDueDatePassed,
        }"
        class="px-3 py-1 rounded"
      >
        {{
          isSubmitted
            ? "Submitted"
            : isDueDatePassed
              ? "Due date passed"
              : "Submit"
        }}
      </button>

      <!-- Graded badge -->
      <button
        *ngIf="assignment.effectiveStatus === 'graded'"
        class="px-3 py-1 bg-green-200 rounded cursor-not-allowed text-green-900"
      >
        Graded
      </button>

      <!-- View Feedback -->
      <button
        *ngIf="assignment.effectiveStatus === 'graded'"
        (click)="handleViewFeedback()"
        class="px-3 py-1 text-red-900 bg-red-100 rounded"
      >
        View Feedback
      </button>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div
    *ngIf="feedbackModalOpen"
    class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
  >
    <div class="bg-white rounded-xl w-full max-w-sm p-6">
      <h2 class="text-lg font-semibold mb-4">Feedback</h2>
      <p class="mb-6">{{ feedbackMessage }}</p>
      <div class="flex justify-end">
        <button
          (click)="closeFeedbackModal()"
          class="px-4 py-2 bg-blue-200 text-blue-700 rounded-lg hover:bg-blue-400 hover:text-white"
        >
          OK
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Submission Modal -->
<app-student-assignment-modal
  [show]="isModalOpen"
  [tenantId]="tenantId"
  [assignment]="assignment"
  (close)="closeModal()"
  (submit)="handleSubmit($event)"
></app-student-assignment-modal>
