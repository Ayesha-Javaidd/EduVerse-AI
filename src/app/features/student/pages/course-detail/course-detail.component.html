<div class="min-h-screen bg-slate-50 relative">
    <app-header pageTitle="Course Details"></app-header>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center h-[calc(100vh-80px)]">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-600"></div>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="flex flex-col justify-center items-center h-[calc(100vh-80px)] text-center p-6">
        <i class="fa-solid fa-triangle-exclamation text-6xl text-red-500 mb-6"></i>
        <p class="text-slate-800 text-2xl font-bold mb-2">Oops!</p>
        <p class="text-slate-600 text-lg mb-8">{{ error }}</p>
        <app-button [variant]="'primary'" (buttonClick)="goBack()">Back to Explore</app-button>
    </div>

    <!-- Content -->
    <div *ngIf="course && !loading" class="pb-32">
        <!-- Hero Section -->
        <div class="relative bg-slate-900 text-white overflow-hidden">
            <!-- Background Image with Blur -->
            <div class="absolute inset-0 z-0">
                <img [src]="course.thumbnailUrl || 'assets/images/default-course.jpg'"
                    class="w-full h-full object-cover opacity-30 blur-sm transform scale-105">
                <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/60 to-transparent"></div>
            </div>

            <div class="relative z-10 max-w-7xl mx-auto px-6 py-12 lg:py-20 flex flex-col lg:flex-row gap-12 items-end">
                <!-- Course Thumbnail (Card Design) -->
                <div class="w-full max-w-sm flex-shrink-0 hidden lg:block">
                    <div class="rounded-2xl overflow-hidden shadow-2xl border-4 border-white/10 relative group">
                        <img [src]="course.thumbnailUrl || 'assets/images/default-course.jpg'"
                            class="w-full aspect-video object-cover">
                        <div
                            class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-all duration-300">
                        </div>
                    </div>
                </div>

                <!-- Course Info -->
                <div class="flex-1">
                    <div class="flex flex-wrap gap-3 mb-4">
                        <span
                            class="px-3 py-1 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-500/30 text-sm font-semibold backdrop-blur-sm">
                            {{ course.category }}
                        </span>
                        <span
                            class="px-3 py-1 rounded-full bg-slate-700/50 text-slate-300 border border-slate-600 text-sm font-semibold backdrop-blur-sm">
                            {{ course.level }}
                        </span>
                        <span *ngIf="course.duration"
                            class="px-3 py-1 rounded-full bg-slate-700/50 text-slate-300 border border-slate-600 text-sm font-semibold backdrop-blur-sm">
                            <i class="fa-regular fa-clock mr-1.5"></i>{{ course.duration }}
                        </span>
                    </div>

                    <h1 class="text-3xl lg:text-5xl font-bold mb-6 leading-tight">{{ course.title }}</h1>

                    <div class="flex items-center gap-4 mb-8">
                        <div
                            class="h-12 w-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-xl shadow-lg border-2 border-white/20">
                            {{ (course.instructorName | slice:0:1) || 'T' }}
                        </div>
                        <div>
                            <p class="text-sm text-slate-400 font-medium">Created by</p>
                            <p class="text-lg font-semibold">{{ course.instructorName || 'Unknown Instructor' }}</p>
                        </div>
                    </div>

                    <!-- Mobile Enroll Button (Visible only on small screens) -->
                    <div class="lg:hidden mt-6">
                        <app-button [variant]="'success'" [size]="'lg'" [fullWidth]="true"
                            customColor="bg-gradient-to-r from-teal-500 to-emerald-500 hover:from-teal-600 hover:to-emerald-600 text-white font-bold shadow-lg shadow-teal-500/20"
                            (buttonClick)="enroll()">
                            Enroll Now - {{ course.price ? (course.price | currency) : 'Free' }}
                        </app-button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="max-w-7xl mx-auto px-6 py-12 grid grid-cols-1 lg:grid-cols-3 gap-12">

            <!-- Left Column: Details -->
            <div class="lg:col-span-2 space-y-12">

                <!-- Description Section -->
                <section>
                    <div class="flex items-center gap-3 mb-6">
                        <div class="h-10 w-1 bg-indigo-500 rounded-full"></div>
                        <h2 class="text-2xl font-bold text-slate-900">About This Course</h2>
                    </div>
                    <p class="text-slate-600 leading-relaxed text-lg whitespace-pre-line">
                        {{ course.description || 'No description provided for this course.' }}
                    </p>
                </section>

                <!-- What You'll Learn / Features -->
                <section class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100">
                    <h2 class="text-xl font-bold text-slate-900 mb-6">Course Highlights</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="flex items-start gap-4">
                            <div
                                class="h-10 w-10 rounded-xl bg-orange-100 text-orange-600 flex items-center justify-center flex-shrink-0">
                                <i class="fa-solid fa-video text-lg"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800 mb-1">Video Lessons</h3>
                                <p class="text-sm text-slate-500">Comprehensive video content uploaded by the
                                    instructor.</p>
                            </div>
                        </div>
                        <div *ngIf="course.hasCertificate" class="flex items-start gap-4">
                            <div
                                class="h-10 w-10 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center flex-shrink-0">
                                <i class="fa-solid fa-certificate text-lg"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800 mb-1">Certificate</h3>
                                <p class="text-sm text-slate-500">Earn a certificate of completion upon finishing.</p>
                            </div>
                        </div>
                        <div *ngIf="course.hasBadges" class="flex items-start gap-4">
                            <div
                                class="h-10 w-10 rounded-xl bg-purple-100 text-purple-600 flex items-center justify-center flex-shrink-0">
                                <i class="fa-solid fa-medal text-lg"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800 mb-1">Badges</h3>
                                <p class="text-sm text-slate-500">Unlock achievement badges as you progress.</p>
                            </div>
                        </div>
                        <div *ngIf="course.hasLifetimeAccess" class="flex items-start gap-4">
                            <div
                                class="h-10 w-10 rounded-xl bg-green-100 text-green-600 flex items-center justify-center flex-shrink-0">
                                <i class="fa-solid fa-infinity text-lg"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800 mb-1">Lifetime Access</h3>
                                <p class="text-sm text-slate-500">Learn at your own pace with unlimited access.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Curriculum / Modules -->
                <section *ngIf="course.modules && course.modules.length > 0">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="h-10 w-1 bg-indigo-500 rounded-full"></div>
                        <h2 class="text-2xl font-bold text-slate-900">Course Content</h2>
                    </div>

                    <div class="space-y-4">
                        <div *ngFor="let module of course.modules; let i = index"
                            class="bg-white rounded-xl border border-slate-200 overflow-hidden">
                            <div
                                class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex justify-between items-center">
                                <div>
                                    <span
                                        class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-1 block">Module
                                        {{ i + 1 }}</span>
                                    <h3 class="font-bold text-slate-800 text-lg">{{ module.title }}</h3>
                                </div>
                                <span class="text-sm text-slate-500 font-medium">{{ module.lessons?.length || 0 }}
                                    Lessons</span>
                            </div>
                            <div class="divide-y divide-slate-100">
                                <div *ngFor="let lesson of module.lessons"
                                    class="px-6 py-3 flex items-center gap-3 hover:bg-slate-50 transition-colors">
                                    <div
                                        class="h-8 w-8 rounded-lg bg-indigo-50 text-indigo-600 flex items-center justify-center flex-shrink-0">
                                        <i
                                            [class]="lesson.type === 'video' ? 'fa-solid fa-play' : 'fa-solid fa-file-alt'"></i>
                                    </div>
                                    <span class="text-slate-700 font-medium">{{ lesson.title }}</span>
                                    <div class="flex-1"></div>
                                    <span class="text-xs text-slate-400 font-mono bg-slate-100 px-2 py-1 rounded">{{
                                        lesson.duration || '5:00' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Instructor Bio -->
                <section>
                    <div class="flex items-center gap-3 mb-6">
                        <div class="h-10 w-1 bg-indigo-500 rounded-full"></div>
                        <h2 class="text-2xl font-bold text-slate-900">Your Instructor</h2>
                    </div>
                    <div
                        class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100 flex flex-col md:flex-row gap-6 items-start">
                        <div
                            class="h-24 w-24 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-3xl shadow-lg flex-shrink-0">
                            {{ (course.instructorName | slice:0:1) || 'T' }}
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-2">{{ course.instructorName }}</h3>
                            <p class="text-slate-600 mb-4 whitespace-pre-line">
                                {{ course.instructorBio || 'Passionate educator and industry expert. Dedicated to
                                creating high-quality learning experiences for students around the world.' }}
                            </p>
                            <div class="flex gap-4">
                                <span class="text-sm text-slate-500"><i
                                        class="fa-solid fa-users mr-2 text-indigo-500"></i>{{ course.enrolledStudents }}
                                    Students</span>
                                <span class="text-sm text-slate-500"><i
                                        class="fa-solid fa-star mr-2 text-amber-500"></i>4.8 Rating</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Column: Sticky Enroll Card -->
            <div class="hidden lg:block">
                <div class="sticky top-24">
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
                        <div class="p-1">
                            <img [src]="course.thumbnailUrl || 'assets/images/default-course.jpg'"
                                class="w-full rounded-xl">
                        </div>
                        <div class="p-8">
                            <div class="flex items-baseline gap-2 mb-6">
                                <span class="text-3xl font-bold text-slate-900">{{ course.price ? (course.price |
                                    currency) : 'Free' }}</span>
                                <span *ngIf="course.price"
                                    class="text-lg text-slate-400 line-through decoration-slate-400 decoration-2">$99.99</span>
                                <span *ngIf="course.price"
                                    class="text-xs font-bold text-green-600 bg-green-100 px-2 py-1 rounded-full ml-auto">80%
                                    OFF</span>
                            </div>

                            <app-button [variant]="'success'" [size]="'xl'" [fullWidth]="true"
                                customColor="bg-gradient-to-r from-teal-500 to-emerald-500 hover:from-teal-600 hover:to-emerald-600 text-white font-bold shadow-lg shadow-teal-500/20 transform hover:-translate-y-1 transition-all duration-300"
                                [disabled]="enrolling" (buttonClick)="enroll()">
                                <span *ngIf="!enrolling">Enroll Now</span>
                                <span *ngIf="enrolling"><i
                                        class="fa-solid fa-circle-notch fa-spin mr-2"></i>Enrolling...</span>
                            </app-button>

                            <p class="text-xs text-center text-slate-400 mt-3 pt-3 border-t border-slate-100">30-Day
                                Money-Back Guarantee</p>

                            <div class="mt-6 space-y-4">
                                <div *ngIf="course.hasLifetimeAccess"
                                    class="flex items-center gap-3 text-slate-600 text-sm">
                                    <i class="fa-solid fa-check text-green-500"></i> Full Lifetime Access
                                </div>
                                <div class="flex items-center gap-3 text-slate-600 text-sm">
                                    <i class="fa-solid fa-check text-green-500"></i> Access on Mobile and TV
                                </div>
                                <div *ngIf="course.hasCertificate"
                                    class="flex items-center gap-3 text-slate-600 text-sm">
                                    <i class="fa-solid fa-check text-green-500"></i> Certificate of Completion
                                </div>
                                <div *ngIf="course.hasBadges" class="flex items-center gap-3 text-slate-600 text-sm">
                                    <i class="fa-solid fa-check text-green-500"></i> Exclusive Course Badges
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SUCCESS MODAL -->
    <div *ngIf="showSuccessModal" class="fixed inset-0 z-[100] flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" (click)="closeModal()"></div>

        <!-- Modal Card -->
        <div
            class="bg-white rounded-3xl shadow-2xl p-8 max-w-sm w-full text-center relative z-10 animate-bounce-in overflow-hidden">
            <!-- Confetti Effect (Pseudo) -->
            <div class="absolute inset-x-0 top-0 h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>

            <div class="mb-6 relative">
                <div
                    class="h-24 w-24 bg-green-100 rounded-full mx-auto flex items-center justify-center animate-pulse-slow">
                    <i class="fa-solid fa-check text-4xl text-green-500"></i>
                </div>
                <!-- Decorative elements -->
                <i class="fa-solid fa-star text-yellow-400 absolute top-0 right-10 animate-spin-slow"></i>
                <i class="fa-solid fa-star text-blue-400 absolute bottom-0 left-10 text-sm"></i>
            </div>

            <h3 class="text-2xl font-bold text-slate-800 mb-2">Welcome Aboard!</h3>
            <p class="text-slate-600 mb-8">
                You have successfully enrolled in <br>
                <span class="font-semibold text-indigo-600">"{{ course?.title }}"</span>
            </p>

            <app-button [variant]="'primary'" [size]="'lg'" [fullWidth]="true"
                customColor="bg-slate-900 text-white hover:bg-slate-800" (buttonClick)="closeModal()">
                Start Learning
            </app-button>
        </div>
    </div>

    <!-- PAYMENT MODAL -->
    <app-payment-modal *ngIf="showPaymentModal" [courseTitle]="course?.title || ''" [price]="course?.price || 0"
        [currency]="course?.currency || 'USD'" (confirmPayment)="onPaymentSuccess()"
        (cancel)="showPaymentModal = false">
    </app-payment-modal>
</div>